<html>
<title>Algoface</title>
<head>
    <script src="./js/angular.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
    <script src="./js/jquery-3.3.1.slim.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/index.css">
</head>
<body ng-app="myApp" class="ng-scope" style="background-image: url('./images/ai.jpg');height: 100%; background-position: center; background-size: cover;">
    <div ng-controller="MyCtrl">
        <div class="container-fluid mb-5">
            <div class="row">
                <div class="col-sm-12">
                    <div class="jumbotron jumbotron-fluid" style="opacity: 0.6">
                        <div class="container">
                            <h1 class="display-4">{{welcomeText}}</h1>
                            <p class="lead"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-sm-8 offset-sm-4">
                    <label class="input-text">{{widthLabel}}</label>
                    <input type="number" class="form-control input-width" placeholder="Enter width..." id="width" name="width" ng-model="width"
                        ng-change="setWidth(width)">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-sm-8 offset-sm-4">
                    <label class="input-text">{{heightLabel}}</label>
                    <input type="number" class="form-control input-width" placeholder="Enter height..." id="height" name="height" ng-model="height"
                        ng-change="setHeight(height)">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-sm-8 offset-sm-4">
                    <label class="input-text">{{image}}</label>
                    <input type='file' ng-disabled="!width || !height" class="form-control input-width" onchange="angular.element(this).scope().imageUpload(event)"
                        multiple accept="image/*" />
                </div>
            </div>
            <div class="row mt-3" ng-if="images.length">
                <div class="col-sm-8 offset-sm-4">
                    <div ng-repeat="data in images">
                        <label class="input-text">{{annotation}}{{ $index + 1 }}</label>
                        <input type="text" class="form-control input-width" placeholder="Enter name..." id="image{{data.id}}" name="name" ng-model="name[data.count]">
                    </div>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-sm-10 offset-sm-1">
                    <div id="carouselExampleControls" class="carousel" style="width: 85%" data-interval="false">
                        <div class="carousel-inner">
                            <div class="carousel-item" data-ng-repeat="image in images" data-ng-class="{active : $first}">
                                <img data-ng-src="{{image.fileName}}" style="margin-left: 400px;" width="{{width}}" height="{{height}}" alt="carousel {{$index}}"
                                /><span class="img-name ml-2">Image {{image.id + 1}}</span>
                            </div>
                        </div>
                        <a ng-if="images.length >0" class="carousel-control-prev" href="#carouselExampleControls" role="button" style="background-color: black"
                            data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a ng-if="images.length >0" class="carousel-control-next" href="#carouselExampleControls" style="background-color: black"
                            role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-sm-2 offset-md-5">
                    <div class="text-center"> <button class="btn btn-primary form-control" ng-disabled="!width || !height || !images.length>0"
                            ng-click="submitImage()">SUBMIT</button></div>
                </div>
            </div>
        </div>
</body>
<script type="text/javascript">
    var myApp = angular.module('myApp', []);
    myApp.controller('MyCtrl', function ($scope, $http) {

        //Input Labels
        $scope.welcomeText = "Display How You Want!!!";
        $scope.widthLabel = "Width";
        $scope.heightLabel = "Height";
        $scope.image = "Image";
        $scope.annotation = "Annotation Image";
        //Input Labels

        $scope.images = []; //Array to store images
        $scope.width = "";  //Width of the image
        $scope.height = ""; //Height of the image
        $scope.count = 0;
        $scope.request = []; //Request for the DB

        $scope.setWidth = function (width) { //Set width of the image
            $scope.width = width;
        }

        $scope.setHeight = function (height) { //Set height of the image
            $scope.height = height;
        }

        $scope.imageUpload = function (event) { //Image Upload
            $scope.count = 0;
            $scope.images = [];
            var files = event.target.files; //FileList object
            $scope.fileName = [];
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                $scope.fileName.push(file.name);
                var reader = new FileReader();
                reader.onload = $scope.imageIsLoaded;
                reader.readAsDataURL(file);
            }
        }

        $scope.imageIsLoaded = function (e) {
            $scope.$apply(function () {
                var obj = {
                    'id': $scope.count,
                    'fileName': e.target.result,
                }
                $scope.images.push(obj);
            });
            $scope.count = $scope.count + 1;
        }

        $scope.submitImage = function () { //Post Request to the DB
            for (var i = 0; i < $scope.images.length; i++) {
                var obj = {
                    'fileName': $scope.fileName[i],
                    'annotation_text': document.getElementById('image' + i).value
                }
                $scope.request.push(obj);
            }
            $http({
                url: 'http://localhost:8081/createImage',
                method: "POST",
                data: $scope.request
            })
                .then(function (response) {
                    // success
                    location.reload();
                    $scope.width = "";
                    $scope.height = "";
                    $scope.name = "";
                    $scope.images = [];
                });
        }
    });
</script>

</html>